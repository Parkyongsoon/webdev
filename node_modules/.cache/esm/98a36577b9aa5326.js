let redis,bcrypt,jwt,axios,qs,crypto,Joi,fs,promisify,db,paging,elasticSearch,fileName,fileOriginalName,fileUnlink;_b9a‍.x([["index",()=>index],["search",()=>search],["view",()=>view]]);_b9a‍.w("redis",[["default",["redis"],function(v){redis=v}]]);_b9a‍.w("bcryptjs",[["default",["bcrypt"],function(v){bcrypt=v}]]);_b9a‍.w("jsonwebtoken",[["default",["jwt"],function(v){jwt=v}]]);_b9a‍.w("axios",[["default",["axios"],function(v){axios=v}]]);_b9a‍.w("querystring",[["default",["qs"],function(v){qs=v}]]);_b9a‍.w("crypto",[["default",["crypto"],function(v){crypto=v}]]);_b9a‍.w("joi",[["default",["Joi"],function(v){Joi=v}]]);_b9a‍.w("fs",[["default",["fs"],function(v){fs=v}]]);_b9a‍.w("util",[["promisify",["promisify"],function(v){promisify=v}]]);_b9a‍.w("../../../models",[["db",["db"],function(v){db=v}]]);_b9a‍.w("../../../utils/pagination",[["paging",["paging"],function(v){paging=v}]]);_b9a‍.w("../../../utils/search",[["elasticSearch",["elasticSearch"],function(v){elasticSearch=v}]]);_b9a‍.w("../../../utils/fileUpload",[["fileName",["fileName"],function(v){fileName=v}],["fileOriginalName",["fileOriginalName"],function(v){fileOriginalName=v}]]);_b9a‍.w("../../../utils/fileUnlink",[["fileUnlink",["fileUnlink"],function(v){fileUnlink=v}]]);















const redisClient = redis.createClient();
const getAsync = promisify(redisClient.get).bind(redisClient);
const lrangeAsync = promisify(redisClient.lrange).bind(redisClient);

/**
 * boardIndex
 */

       const index = async ctx => {
  try {

    return paging(
      ctx,       
      db.tbl_eluly_board,
      {},
      'user/board/index',
      'api/board?page='
    );

  } catch (e) {
    ctx.throw(500, e);
  };
};

/**
 * boardSearch
 */

       const search = async ctx => {
  try {

      switch (ctx.query.searchType) {
        case 'title':
          console.log('title')
          return elasticSearch(
            ctx,
            'board',
            ['title'],
            'user/board/index',
            'api/board/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
          );

        case 'content':
          console.log('content')
          return elasticSearch(
            ctx,
            'board',
            ['content'],
            'user/board/index',
            'api/board/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
          );

        case 'name':
          console.log('name')
          return elasticSearch(
            ctx,
            'board',
            ['name'],
            'user/board/index',
            'api/board/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
          );

        case 'title_content':
          console.log('title_content')
          return elasticSearch(
            ctx,
            'board',
            ['title', 'content'],
            'user/board/index',
            'api/board/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
          );

        default:
          break;
      };
  } catch (e) {
    _b9a‍.g.console.log(e)
    ctx.throw(500, e);
  };
};

/**
 * customerContentView
 */

       const view = async ctx => {
  try {

    const boardView = await db.tbl_eluly_board.findOne({where:{id: ctx.params.id }});

    ctx.status = 200;

    await ctx.render('user/board/view', { 
      boardView
    }); 
  } catch (e) {
    ctx.throw(500, e);
  };
};

// let pageNum = parseInt(ctx.query.page);
    // if (!pageNum) {
    //   pageNum = 1;
    // };

    // let offset = 0;
    // const limit = 10;

    // if(pageNum > 1) {
    //   offset = 10 * (pageNum - 1);
    // };

    // const pageSize = 10;
    
    // const pageStart = Math.floor((pageNum - 1) / pageSize) * pageSize + 1;

    // let pageEnd = (pageStart + pageSize) - 1;
    
    // const total = await db.tbl_eluly_board.count({});
    
    // const board = await db.tbl_eluly_board.findAll({limit: limit, offset: offset});

    // const pageTotal = Math.ceil(total / limit);

    // if (pageEnd > pageTotal) {
    //   pageEnd = pageTotal;
    // };

    // ctx.status = 200;

    // await ctx.render('user/board/index', {
    //   board,
    //   pageNum,
    //   pageSize,
    //   pageStart,
    //   pageEnd,
    //   pageTotal,
    //   pageUrl: 'api/board?page=',
    //   hits: '',
    //   searchType:'',
    // });