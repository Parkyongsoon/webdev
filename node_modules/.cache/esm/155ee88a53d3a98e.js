let dotenv,db,paging,elasticSearch;_53d‍.x([["index",()=>index],["search",()=>search],["view",()=>view]]);_53d‍.w("dotenv",[["default",["dotenv"],function(v){dotenv=v}]]);_53d‍.w("../../../models",[["db",["db"],function(v){db=v}]]);_53d‍.w("../../../utils/pagination",[["paging",["paging"],function(v){paging=v}]]);_53d‍.w("../../../utils/search",[["elasticSearch",["elasticSearch"],function(v){elasticSearch=v}]]);

dotenv.config();





const { JWT_SECRET } = process.env

/**
 * qnaCtrl
 */

       const index = async ctx => {
  try {
    return paging(
      ctx,       
      db.tbl_eluly_qna,
      {},
      'admin/qna/index',
      'admin/api/qna?page='
    );
  } catch (e) {
    ctx.throw(500, e);
  };
};

       const search = async ctx => {
  try {

    switch (ctx.query.searchType) {
      case 'title':
        console.log('title')
        return elasticSearch(
          ctx,
          'qna',
          ['title'],
          'admin/qna/index',
          'admin/api/qna/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
        );

      case 'content':
        console.log('content')
        return elasticSearch(
          ctx,
          'qna',
          ['content'],
          'admin/qna/index',
          'admin/api/qna/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
        );

      case 'name':
        console.log('name')
        return elasticSearch(
          ctx,
          'qna',
          ['name'],
          'admin/qna/index',
          'admin/api/qna/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
        );

      case 'title_content':
        console.log('title_content')
        return elasticSearch(
          ctx,
          'qna',
          ['title_content'],
          'admin/qna/index',
          'admin/api/qna/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
        );

      default:
        break;
    };
  } catch (e) {
    _53d‍.g.console.log(e)
  }
}

       const view = async ctx => {
  try {

    const qnaView = await db.tbl_eluly_qna.findOne({ where: { id: ctx.params.id }});
    const qnaComment = await db.tbl_eluly_qnaComment.findAll({where: { tblElulyQnaId: ctx.params.id}, include: [db.tbl_eluly_qna]});
    
    ctx.status = 200;

    await ctx.render('admin/qna/view', {
      qnaView,
      qnaComment
    });
  } catch (e) {
    ctx.throw(500, e);
  };
};