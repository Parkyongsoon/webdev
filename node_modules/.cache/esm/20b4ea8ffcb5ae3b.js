let redis,bcrypt,jwt,axios,qs,crypto,Joi,fs,promisify,db,paging,elasticSearch,fileName,fileOriginalName,fileUnlink;_fcb‍.x([["index",()=>index],["search",()=>search],["view",()=>view]]);_fcb‍.w("redis",[["default",["redis"],function(v){redis=v}]]);_fcb‍.w("bcryptjs",[["default",["bcrypt"],function(v){bcrypt=v}]]);_fcb‍.w("jsonwebtoken",[["default",["jwt"],function(v){jwt=v}]]);_fcb‍.w("axios",[["default",["axios"],function(v){axios=v}]]);_fcb‍.w("querystring",[["default",["qs"],function(v){qs=v}]]);_fcb‍.w("crypto",[["default",["crypto"],function(v){crypto=v}]]);_fcb‍.w("joi",[["default",["Joi"],function(v){Joi=v}]]);_fcb‍.w("fs",[["default",["fs"],function(v){fs=v}]]);_fcb‍.w("util",[["promisify",["promisify"],function(v){promisify=v}]]);_fcb‍.w("../../../models",[["db",["db"],function(v){db=v}]]);_fcb‍.w("../../../utils/pagination",[["paging",["paging"],function(v){paging=v}]]);_fcb‍.w("../../../utils/search",[["elasticSearch",["elasticSearch"],function(v){elasticSearch=v}]]);_fcb‍.w("../../../utils/fileUpload",[["fileName",["fileName"],function(v){fileName=v}],["fileOriginalName",["fileOriginalName"],function(v){fileOriginalName=v}]]);_fcb‍.w("../../../utils/fileUnlink",[["fileUnlink",["fileUnlink"],function(v){fileUnlink=v}]]);















const redisClient = redis.createClient();
const getAsync = promisify(redisClient.get).bind(redisClient);
const lrangeAsync = promisify(redisClient.lrange).bind(redisClient);

/**
 * adminBoardIndex
 */

       const index = async ctx => {
  try {

    return paging(
      ctx,       
      db.tbl_eluly_board,
      {},
      'admin/board/index',
      'admin/api/board?page='
    );

  } catch (e) {
    ctx.throw(500, e);
  };
};

/**
 * adminBoardSearch
 */

       const search = async ctx => {
  try {

    switch (ctx.query.searchType) {
      case 'title':
        console.log('title')
        return elasticSearch(
          ctx,
          'board',
          ['title'],
          'admin/board/index',
          'admin/api/board/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
        );

      case 'content':
        console.log('content')
        return elasticSearch(
          ctx,
          'board',
          ['content'],
          'admin/board/index',
          'admin/api/board/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
        );

      case 'name':
        console.log('name')
        return elasticSearch(
          ctx,
          'board',
          ['name'],
          'admin/board/index',
          'admin/api/board/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
        );

      case 'title_content':
        console.log('title_content')
        return elasticSearch(
          ctx,
          'board',
          ['title', 'content'],
          'admin/board/index',
          'admin/api/board/search?searchType='+ ctx.query.searchType +'&search=' + ctx.query.search + '&page=',
        );

      default:
        break;
    };
  } catch (e) {
    _fcb‍.g.console.log(e)
    ctx.throw(500, e);
  };
};

/**
 * dminBoardView
 */

       const view = async ctx => {
  try {

    const boardView = await db.tbl_eluly_board.findOne({where:{id: ctx.params.id }});

    ctx.status = 200;

    await ctx.render('admin/board/view', { 
      boardView
    }); 
  } catch (e) {
    ctx.throw(500, e);
  };
};

// let pageNum = parseInt(ctx.query.page);
    // if (!pageNum) {
    //   pageNum = 1;
    // };

    // let offset = 0;
    // const limit = 10;

    // if(pageNum > 1) {
    //   offset = 10 * (pageNum - 1);
    // };

    // const pageSize = 10;
    
    // const pageStart = Math.floor((pageNum - 1) / pageSize) * pageSize + 1;

    // let pageEnd = (pageStart + pageSize) - 1;
    
    // const total = await db.tbl_eluly_board.count({});
    
    // const board = await db.tbl_eluly_board.findAll({limit: limit, offset: offset});

    // const pageTotal = Math.ceil(total / limit);

    // if (pageEnd > pageTotal) {
    //   pageEnd = pageTotal;
    // };

    // ctx.status = 200;

    // await ctx.render('home/board/index', {
    //   board,
    //   pageNum,
    //   pageSize,
    //   pageStart,
    //   pageEnd,
    //   pageTotal,
    //   pageUrl: 'api/board?page=',
    //   hits: '',
    //   searchType:'',
    // });