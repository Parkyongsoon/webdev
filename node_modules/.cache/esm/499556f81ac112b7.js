let jwt,dotenv,db;_1ac‍.x([["add",()=>add],["edit",()=>edit],["remove",()=>remove]]);_1ac‍.w("jsonwebtoken",[["default",["jwt"],function(v){jwt=v}]]);_1ac‍.w("dotenv",[["default",["dotenv"],function(v){dotenv=v}]]);_1ac‍.w("../../../models",[["db",["db"],function(v){db=v}]]);


dotenv.config();



const { JWT_SECRET } = process.env

       const add = async ctx => {
  try {
    const { content, qnaId } = ctx.request.body;
    const token = ctx.cookies.get('token');
    const payload = jwt.verify(token, JWT_SECRET);

    await db.tbl_eluly_qnaComment.create({
      name: payload.userName,
      content,
      tblElulyQnaId: qnaId,
      tblElulyAdminId: payload.userId
    });

    await db.tbl_eluly_qna.update({
      answer: true
    }, {
      where: {
        id: qnaId
      }
    });

    ctx.status = 200;

    return ctx.redirect('/admin/api/qna/' + qnaId);
    
  } catch (e) {
    ctx.throw(500, e);
  };
};

       const edit = async ctx => {
  try {
    const { content, qnaId } = ctx.request.body;

    await db.tbl_eluly_qnaComment.update({
      content: content
    }, {
      where: {
        id: ctx.params.id
      }
    });

    ctx.status = 200;

    return ctx.redirect('/admin/api/qna/' + qnaId);
  } catch (e) {
    ctx.throw(500, e);
  };
};

       const remove = async ctx => {
  try {
    const { qnaId } = ctx.request.body;

    await db.tbl_eluly_qna.update({
      answer: false
    }, {
      where: {
        id: qnaId
      }
    })
    await db.tbl_eluly_qnaComment.destroy({
      where:{
        id: ctx.params.id
      }, force: true});

    ctx.status = 200;
  
    return ctx.redirect('/admin/api/qna/' + qnaId);
  } catch (e) {
    ctx.throw(500, e);
  };
};